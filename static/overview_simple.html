<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Overview - 简化版测试</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { overflow: hidden; background: #0a1628; color: #fff; font-family: Arial, sans-serif; }
        #canvas { width: 100vw; height: 100vh; display: block; }
        #info {
            position: absolute; top: 20px; left: 20px;
            background: rgba(0,0,0,0.8); padding: 15px;
            border-radius: 5px; max-width: 400px;
        }
    </style>
</head>
<body>
    <canvas id="canvas"></canvas>
    <div id="info">加载地面模型中...</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/controls/OrbitControls.js"></script>

    <script>
        // === 完全复制three_test.html的成功代码 ===
        const info = document.getElementById('info');
        function log(msg) { console.log(msg); info.innerHTML += msg + '<br>'; }

        log('初始化Three.js...');

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x0a1628);

        const canvas = document.getElementById('canvas');
        const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 100000);
        camera.position.set(0, 100, 200);

        const renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);

        const controls = new THREE.OrbitControls(camera, renderer.domElement);
        controls.enableDamping = true;

        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        scene.add(ambientLight);

        const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
        directionalLight.position.set(100, 200, 100);
        scene.add(directionalLight);

        const gridHelper = new THREE.GridHelper(500, 20);
        scene.add(gridHelper);

        log('✓ 场景创建完成');

        // 先测试004-051.glb (settlement.html成功用的文件)
        log('先测试 004-051.glb (345MB，settlement.html用这个成功)...');

        const loader = new THREE.GLTFLoader();
        const startTime = Date.now();

        loader.load(
            'glb/004-051.glb',  // 先用成功的文件测试
            function(gltf) {
                const loadTime = ((Date.now() - startTime) / 1000).toFixed(2);
                log(`✓✓✓ 模型加载成功！耗时 ${loadTime}秒`);

                const model = gltf.scene;
                scene.add(model);

                const box = new THREE.Box3().setFromObject(model);
                const center = box.getCenter(new THREE.Vector3());
                const size = box.getSize(new THREE.Vector3());

                log(`模型尺寸: ${size.x.toFixed(0)} x ${size.y.toFixed(0)} x ${size.z.toFixed(0)}`);

                model.position.sub(center);

                const maxDim = Math.max(size.x, size.y, size.z);
                camera.position.set(maxDim, maxDim * 0.8, maxDim * 1.5);
                camera.lookAt(0, 0, 0);
                controls.target.set(0, 0, 0);
                controls.update();

                log('✓ 004-051.glb 成功！现在尝试 9-10Ground.glb...');

                // 成功后尝试加载9-10Ground.glb
                setTimeout(() => {
                    log('<br>开始加载 9-10Ground.glb (354MB)...');
                    const loader2 = new THREE.GLTFLoader();
                    const start2 = Date.now();

                    loader2.load(
                        'glb/9-10Ground.glb',
                        function(gltf2) {
                            log(`✓✓✓ 9-10Ground.glb 也成功了！耗时 ${((Date.now()-start2)/1000).toFixed(2)}秒`);
                            // 移除旧模型
                            scene.remove(model);
                            // 添加新模型
                            const model2 = gltf2.scene;
                            scene.add(model2);
                            const box2 = new THREE.Box3().setFromObject(model2);
                            const center2 = box2.getCenter(new THREE.Vector3());
                            model2.position.sub(center2);
                        },
                        function(xhr) {
                            if (xhr.lengthComputable) {
                                log(`9-10Ground进度: ${(xhr.loaded/xhr.total*100).toFixed(1)}%`);
                            }
                        },
                        function(err) {
                            log(`✗ 9-10Ground失败: ${err.message}`);
                        }
                    );
                }, 2000);
            },
            function(xhr) {
                if (xhr.lengthComputable) {
                    const percent = (xhr.loaded / xhr.total * 100).toFixed(1);
                    const mb = (xhr.loaded / 1024 / 1024).toFixed(1);
                    log(`进度: ${percent}% (${mb}MB)`);
                }
            },
            function(error) {
                log(`✗ 失败: ${error.message || error}`);
                console.error('详细错误:', error);
            }
        );

        function animate() {
            requestAnimationFrame(animate);
            controls.update();
            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
